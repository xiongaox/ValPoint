# 图床配置

ValPoint 支持三大主流云存储服务作为图床，用于存储点位图片。

## 支持的图床

### 阿里云 OSS
- 稳定性高
- 国内访问速度快
- 价格实惠

### 腾讯云 COS
- 与微信生态集成
- CDN 加速
- 按量计费

### 七牛云 Kodo
- 免费额度较大
- 操作简单
- 适合个人使用

## 配置步骤

### 1. 打开设置

点击右下角的 **快捷功能** 中的 **图床配置** 弹窗。

### 2. 选择图床类型

在图床配置面板中选择你要使用的图床类型。

### 3. 填写配置信息

根据选择的图床类型，填写对应的配置信息。

## 阿里云 OSS 配置

### 所需信息

| 字段 | 说明 | 获取方式 |
|------|------|----------|
| Access Key ID | 访问密钥 ID | 阿里云控制台 → AccessKey 管理 |
| Access Key Secret | 访问密钥 | 同上 |
| Bucket | 存储桶名称 | OSS 控制台 → Bucket 列表 |
| Region | 区域 | 如：`oss-cn-hangzhou` |
| 自定义域名 | CDN 域名（可选） | OSS 控制台 → 域名管理 |

### 配置示例

```json
{
  "provider": "aliyun",
  "accessKeyId": "LTAI5t...",
  "accessKeySecret": "xxx...",
  "bucket": "my-valpoint",
  "area": "oss-cn-hangzhou",
  "customUrl": "https://cdn.example.com"
}
```

### 权限配置

在阿里云 OSS 控制台：
1. 进入 Bucket 设置
2. 设置读写权限为"公共读"
3. 配置 CORS 规则：
   ```json
   {
     "allowedOrigins": ["*"],
     "allowedMethods": ["GET", "POST", "PUT"],
     "allowedHeaders": ["*"],
     "exposeHeaders": [],
     "maxAgeSeconds": 3600
   }
   ```

## 腾讯云 COS 配置

### 所需信息

| 字段 | 说明 | 获取方式 |
|------|------|----------|
| Secret ID | 密钥 ID | 腾讯云控制台 → 访问管理 → API 密钥 |
| Secret Key | 密钥 | 同上 |
| Bucket | 存储桶名称 | COS 控制台 → 存储桶列表 |
| App ID | 应用 ID | 存储桶名称中的数字部分 |
| Region | 区域 | 如：`ap-guangzhou` |
| 自定义域名 | CDN 域名（可选） | COS 控制台 → 域名管理 |

### 配置示例

```json
{
  "provider": "tencent",
  "secretId": "AKIDxxx...",
  "secretKey": "xxx...",
  "bucket": "my-valpoint",
  "appId": "1234567890",
  "area": "ap-guangzhou",
  "customUrl": "https://cdn.example.com"
}
```

### 权限配置

在腾讯云 COS 控制台：
1. 进入存储桶设置
2. 设置访问权限为"公有读私有写"
3. 配置跨域访问 CORS：
   ```json
   {
     "AllowedOrigins": ["*"],
     "AllowedMethods": ["GET", "POST", "PUT"],
     "AllowedHeaders": ["*"],
     "ExposeHeaders": [],
     "MaxAgeSeconds": 3600
   }
   ```

## 七牛云 Kodo 配置

### 所需信息

| 字段 | 说明 | 获取方式 |
|------|------|----------|
| Access Key | 访问密钥 | 七牛云控制台 → 密钥管理 |
| Secret Key | 密钥 | 同上 |
| Bucket | 存储空间名称 | Kodo 控制台 → 空间管理 |
| Region | 区域 | 如：`z0`（华东）、`z1`（华北） |
| Domain | 访问域名 | 空间设置 → 域名管理 |

### 配置示例

```json
{
  "provider": "qiniu",
  "accessKey": "xxx...",
  "secretKey": "xxx...",
  "bucket": "my-valpoint",
  "area": "z0",
  "url": "https://cdn.example.com"
}
```

### 权限配置

在七牛云 Kodo 控制台：
1. 进入空间设置
2. 设置访问控制为"公开"
3. 绑定自定义域名（必需）

## 图片上传

### 剪贴板上传（推荐）

1. 在游戏中截图（通常是 F12）
2. 切换到浏览器
3. 在编辑器中点击 **"剪贴板上传"** 按钮
4. 图片自动上传并显示预览

::: tip 优势
- 无需保存截图文件
- 一键上传，快速便捷
- 自动压缩和格式转换
:::

### 链接输入

1. 点击 **"启用链接输入"** 按钮
2. 手动粘贴图片 URL
3. 适用于已有图片链接的情况

## 图片处理

### 自动压缩

上传时自动压缩图片：
- 最大宽度：1920px
- 质量：85%（可调节）
- 格式：JPEG

### 格式转换

支持的输入格式：
- PNG
- JPEG
- WebP

输出格式：JPEG

### 文件命名

自动生成唯一文件名：
```
img/{timestamp}.jpg
```

示例：`img/1704067200000.jpg`

## 配置管理

### 保存配置

配置保存在浏览器的 LocalStorage 中：
- 不会上传到服务器
- 仅在当前浏览器有效
- 清除浏览器数据会丢失配置

### 导出配置

::: warning 注意
目前不支持导出配置。建议：
- 记录配置信息
- 或截图保存
:::

### 切换图床

可以随时切换图床类型：
1. 打开设置
2. 选择新的图床类型
3. 填写配置信息
4. 保存

::: tip 提示
切换图床不会影响已上传的图片，但新图片会上传到新图床。
:::

## 成本估算

### 阿里云 OSS

- 存储费用：约 ¥0.12/GB/月
- 流量费用：约 ¥0.50/GB
- 请求费用：约 ¥0.01/万次

**估算**：1000 张图片（约 500MB），月访问 10000 次，月费用约 ¥1-2

### 腾讯云 COS

- 存储费用：约 ¥0.10/GB/月
- 流量费用：约 ¥0.50/GB
- 请求费用：约 ¥0.01/万次

**估算**：与阿里云类似

### 七牛云 Kodo

- 免费额度：10GB 存储 + 10GB 流量/月
- 超出后：约 ¥0.15/GB/月（存储）+ ¥0.29/GB（流量）

**估算**：个人使用基本在免费额度内

## 安全建议

### 密钥安全

::: danger 重要
- 不要将密钥提交到 Git
- 不要在公开场合分享密钥
- 定期更换密钥
- 使用子账号密钥（权限最小化）
:::

### 权限控制

建议配置：
- 存储桶：公共读，私有写
- 子账号：仅授予上传权限
- 启用防盗链（可选）

### 成本控制

- 设置费用预警
- 定期清理无用图片
- 使用 CDN 减少流量费用

## 常见问题

### Q: 上传失败怎么办？

检查以下几点：
1. **配置是否正确**
   - Access Key / Secret Key
   - Bucket 名称
   - 区域代码

2. **权限是否足够**
   - 存储桶是否允许上传
   - 密钥是否有写入权限

3. **网络是否正常**
   - 检查网络连接
   - 尝试访问图床控制台

4. **CORS 是否配置**
   - 检查跨域配置
   - 允许来源设置为 `*`

### Q: 图片加载慢？

解决方案：
1. 配置 CDN 加速
2. 选择离用户更近的区域
3. 启用图片压缩

### Q: 配置丢失了？

原因：清除了浏览器数据

解决方案：
- 重新配置图床
- 建议记录配置信息

### Q: 可以使用多个图床吗？

不可以。同一时间只能使用一个图床。

### Q: 已上传的图片可以迁移吗？

需要手动迁移：
1. 下载所有图片
2. 上传到新图床
3. 更新数据库中的图片 URL

### Q: 图床费用太高怎么办？

建议：
1. 使用七牛云免费额度
2. 启用图片压缩
3. 配置 CDN 缓存
4. 定期清理无用图片
